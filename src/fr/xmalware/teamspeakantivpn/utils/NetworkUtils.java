package fr.xmalware.teamspeakantivpn.utils;

import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.net.URL;
import java.net.URLConnection;

/**
 * 
 * Network utils
 * 
 * @author xMalware
 *
 */
public class NetworkUtils
{

	/**
	 * Fetch source code with API
	 * 
	 * @param link
	 * @param apiKey
	 * @return
	 */
	public static String fetchSourceCodeWithIPDetector(String fullUrl, String apiKey) {
		// Try to
		try {

			// Set the user agent
			System.setProperty("http.agent", "Mozilla/5.0");
			// Create url
			URL url = new URL(fullUrl);
			// Do the connection
			URLConnection con = url.openConnection();
			// Set the user agent
			con.setRequestProperty("User-Agent", "Mozilla/5.0");
			// Set API key
			con.setRequestProperty("API-Key", apiKey);
			// Get input stream
			final InputStream in = con.getInputStream();
			// Get the output stream
			final ByteArrayOutputStream result = new ByteArrayOutputStream();
			// Create a new buffer
			final byte[] buffer = new byte[1024];
			// Buffer length
			int length;
			// While the length isn't equal to -1.
			while ((length = in.read(buffer)) != -1)
			{
				// We write the data
				result.write(buffer, 0, length);
			}
			// Return the result in UTF-8
			return result.toString("UTF-8");
		}
		// Error case
		catch (Exception error) {
			// Print the error
			return null;
			// Returns 0 (I don't remember why)
		}
	}

}